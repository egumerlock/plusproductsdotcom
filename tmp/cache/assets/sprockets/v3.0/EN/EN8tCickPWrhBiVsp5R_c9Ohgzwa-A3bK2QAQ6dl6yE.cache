I"(function() {
  var oldSync,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  Backbone.ajax = Spree.ajax;

  oldSync = Backbone.sync;

  Backbone.sync = function(method, model, options) {
    var beforeSend, data, postMethods;
    beforeSend = options.beforeSend;
    options.beforeSend = function(xhr) {
      var token;
      token = $('meta[name="csrf-token"]').attr('content');
      if (token) {
        xhr.setRequestHeader('X-CSRF-Token', token);
      }
      if (beforeSend) {
        return beforeSend.apply(this, arguments);
      }
    };
    postMethods = ['update', 'create', 'patch'];
    if ((model != null ? model.paramRoot : void 0) && !options.data && indexOf.call(postMethods, method) >= 0) {
      options.contentType = "application/json";
      data = {};
      data[model.paramRoot] = model.toJSON(options);
      options.data = JSON.stringify(data);
    }
    return oldSync(method, model, options);
  };

}).call(this);
:ET